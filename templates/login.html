<!DOCTYPE html>
<html lang="zh" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - {{ server_name }} Ops</title>
   <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
   <link href="{{ url_for('static', filename='css/all.min.css') }}" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0;
            overflow: hidden;
        }
        /* 动态背景装饰 */
        .bg-glow {
            position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, rgba(31,111,235,0.1) 0%, rgba(0,0,0,0) 70%);
            top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: -1;
        }
        .login-card { 
            width: 100%; max-width: 360px; 
            background: rgba(22, 27, 34, 0.7); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            padding: 2.5rem;
        }
        .form-control { 
            background: rgba(13, 17, 23, 0.8) !important; 
            border-color: #30363d !important; color: #fff !important; 
            padding: 0.75rem 1rem;
        }
        .form-control:focus { border-color: #1f6feb !important; box-shadow: 0 0 0 3px rgba(31,111,235,0.3); }
        .btn-primary { 
            background: #238636; border: none; padding: 0.75rem; font-weight: 600; letter-spacing: 0.5px;
            transition: all 0.2s;
        }
        .btn-primary:hover { background: #2ea043; transform: translateY(-1px); }
        .logo-icon { font-size: 3rem; color: #1f6feb; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    <div class="login-card text-center position-relative">
        <i class="fas fa-server logo-icon"></i>
        <h4 class="text-white mb-4 fw-bold">登陆到面板</h4>
        
        {% if error %}
        <div id="login-error" class="alert alert-danger py-2 small border-0 bg-danger bg-opacity-25 text-white">{{ error }}</div>
        {% endif %}
        
        <form id="login-form" method="POST">
            <div class="mb-4 text-start">
                <label class="form-label text-muted small text-uppercase fw-bold">Password</label>
                <div class="input-group">
                    <span class="input-group-text bg-dark border-secondary text-muted"><i class="fas fa-key"></i></span>
                    <input type="password" name="password" class="form-control" placeholder="••••••••" autofocus>
                </div>
            </div>
            <button id="login-btn" type="submit" class="btn btn-primary w-100 rounded-pill">登陆</button>
        </form>
    </div>

    <script>
        // 从后端安全获取等待时间
        const waitSeconds = parseInt("{{ wait_seconds | default(0) }}");
        const loginBtn = document.getElementById('login-btn');
        const errorMsg = document.getElementById('login-error');
        const loginForm = document.getElementById('login-form');

        if (waitSeconds > 0) {
            startCooldown(waitSeconds);
        }

        function startCooldown(seconds) {
            let remaining = seconds;
            loginBtn.disabled = true;
            
            const originalBtnText = loginBtn.innerText;
            const originalErrorText = errorMsg ? errorMsg.innerText : "";

            const timer = setInterval(() => {
                remaining--;
                loginBtn.innerText = `重试 (${remaining}s)`;
                if (errorMsg) {
                    errorMsg.innerHTML = `${originalErrorText}<br><div class="mt-2 pt-2 border-top border-white border-opacity-10 small opacity-75"><i class="fas fa-clock me-1"></i>请在 ${remaining} 秒后重试</div>`;
                }

                if (remaining <= 0) {
                    clearInterval(timer);
                    loginBtn.disabled = false;
                    loginBtn.innerText = originalBtnText;
                    if (errorMsg && originalErrorText.includes("Invalid")) {
                        errorMsg.style.display = 'none';
                    } else if (errorMsg) {
                        errorMsg.innerText = originalErrorText;
                    }
                }
            }, 1000);
        }

        // 拦截快速点击
        loginForm.onsubmit = () => {
            if (loginBtn.disabled) return false;
            loginBtn.disabled = true;
            loginBtn.innerText = "正在验证...";
        };
    </script>
</body>
</html>
